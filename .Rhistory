))))))))))))))) %>%
# take out location names to take out duplicate
filter(location_qf == "d") %>%
# take out Golden Jubilee
filter(hb != is.na(hb)) %>%
# take out unused columns
# take out location to remove duplicate
select(date,  hb, specialty_name, all_staffed_beds,
total_occupied_beds, average_available_staffed_beds,
average_occupied_beds, percentage_occupancy)
wranged_beds_no_gj_q <- raw_beds %>%
clean_names() %>%
# (q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
# rename the columns above
mutate(date = quarter
# ,
# quarter = q
) %>%
# Change Heath Board names to read better
mutate(hb = if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", NA_character_)
))))))))))))))) %>%
# take out location names to take out duplicate
filter(location_qf == "d") %>%
# take out Golden Jubilee
filter(hb != is.na(hb)) %>%
# take out unused columns
# take out location to remove duplicate
select(date,  hb, specialty_name, all_staffed_beds,
total_occupied_beds, average_available_staffed_beds,
average_occupied_beds, percentage_occupancy)
wranged_beds_no_gj_q
wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb %in% "Scotland",
specialty_name == "Emergency Grouping") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
as_tsibble(index = date) %>%
gg_season(percentage_occupancy)
wranged_beds_no_gj_q %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb %in% "Scotland",
specialty_name == "Emergency Grouping") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
as_tsibble(index = date) %>%
gg_season(percentage_occupancy)
library(janitor)
library(tidyverse)
library(lubridate)
library(ggplot2)
raw_beds <- read_csv("data/beds_by_nhs_board_of_treatment_and_specialty.csv")
wranged_beds_no_gj <- raw_beds %>%
clean_names() %>%
mutate(q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
# rename the columns above
mutate(date = quarter) %>%
# Change Heath Board names to read better
mutate(hb = if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", NA_character_)
))))))))))))))) %>%
# take out location names to take out duplicate
filter(location_qf == "d") %>%
# take out Golden Jubilee
filter(hb != is.na(hb)) %>%
# take out unused columns
# take out location to remove duplicate
select(date, quarter, hb, specialty_name, all_staffed_beds,
total_occupied_beds, average_available_staffed_beds,
average_occupied_beds, percentage_occupancy)
library(janitor)
library(tidyverse)
library(lubridate)
library(ggplot2)
raw_beds <- read_csv("data/beds_by_nhs_board_of_treatment_and_specialty.csv")
wranged_beds_no_gj <- raw_beds %>%
clean_names() %>%
mutate(q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
# rename the columns above
mutate(date = quarter) %>%
# Change Heath Board names to read better
mutate(hb = if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", NA_character_)
))))))))))))))) %>%
# take out location names to take out duplicate
filter(location_qf == "d") %>%
# take out Golden Jubilee
filter(hb != is.na(hb)) %>%
# take out unused columns
# take out location to remove duplicate
select(date, quarter, hb, specialty_name, all_staffed_beds,
total_occupied_beds, average_available_staffed_beds,
average_occupied_beds, percentage_occupancy)
wranged_beds_no_gj
wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb == "Scotland") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
ggplot(aes(x = date, y = percentage_occupancy, col = specialty_name)) +
geom_point() +
geom_line()
wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb == "Scotland") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
ggplot(aes(x = date, y = all_staffed_beds, col = specialty_name)) +
geom_point() +
geom_line()
wranged_beds_no_gj <- raw_beds %>%
clean_names() %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
# rename the columns above
mutate(date = quarter) %>%
# Change Heath Board names to read better
mutate(hb = if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", NA_character_)
))))))))))))))) %>%
# take out location names to take out duplicate
filter(location_qf == "d") %>%
# take out Golden Jubilee
filter(hb != is.na(hb)) %>%
# take out unused columns
# take out location to remove duplicate
select(date, quarter, hb, specialty_name, all_staffed_beds,
total_occupied_beds, average_available_staffed_beds,
average_occupied_beds, percentage_occupancy)
wranged_beds_no_gj
wranged_beds_no_gj <- raw_beds %>%
clean_names() %>%
# Change to date format
#mutate(quarter = yq(quarter)) %>%
# rename the columns above
mutate(date = quarter) %>%
# Change Heath Board names to read better
mutate(hb = if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", NA_character_)
))))))))))))))) %>%
# take out location names to take out duplicate
filter(location_qf == "d") %>%
# take out Golden Jubilee
filter(hb != is.na(hb)) %>%
# take out unused columns
# take out location to remove duplicate
select(date, quarter, hb, specialty_name, all_staffed_beds,
total_occupied_beds, average_available_staffed_beds,
average_occupied_beds, percentage_occupancy)
wranged_beds_no_gj
wranged_beds_no_gj <- raw_beds %>%
clean_names() %>%
mutate(q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
# rename the columns above
mutate(date = quarter,
quarter = q) %>%
# Change Heath Board names to read better
mutate(hb = if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", NA_character_)
))))))))))))))) %>%
# take out location names to take out duplicate
filter(location_qf == "d") %>%
# take out Golden Jubilee
filter(hb != is.na(hb)) %>%
# take out unused columns
# take out location to remove duplicate
select(date, quarter, hb, specialty_name, all_staffed_beds,
total_occupied_beds, average_available_staffed_beds,
average_occupied_beds, percentage_occupancy)
wranged_beds_no_gj
wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb == "Scotland") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
ggplot(aes(x = date, y = percentage_occupancy, col = specialty_name)) +
geom_point() +
geom_line()
wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb == "Scotland") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
ggplot(aes(x = date, y = all_staffed_beds, col = specialty_name)) +
geom_point() +
geom_line()
bigest_specialty <- wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb == "Scotland") %>%
group_by(specialty_name) %>%
summarise(count = sum(episodes)) %>%
arrange(desc(count)) %>%
head(3)
bigest_specialty <- wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb == "Scotland") %>%
group_by(specialty_name) %>%
summarise(count = sum(all_staffed_beds)) %>%
arrange(desc(count)) %>%
head(3)
View(bigest_specialty)
bigest_specialty <- wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb == "Scotland") %>%
group_by(specialty_name) %>%
summarise(count = sum(all_staffed_beds)) %>%
arrange(desc(count)) %>%
head(3)
wranged_beds_no_gj %>%
filter(specialty_name %in% c(bigest_specialty$specialty_name)) %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb == "Scotland") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
ggplot(aes(x = date, y = all_staffed_beds, col = specialty_name)) +
geom_point() +
geom_line()
activity_no_gj <- raw_activity %>%
clean_names() %>%
# Create new column for quarters
mutate(q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
# rename the columns above
mutate(date = quarter,
quarter = q) %>%
# Change Heath Board names to read better
mutate(
hb =
if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", NA_character_)
))))))))))))))) %>%
# take out location names to take out duplicate
filter(location_qf == "d") %>%
# take out Golden Jubilee
filter(hb != is.na(hb)) %>%
# take out unsed columns
select(date, quarter, hb, location, admission_type,
specialty, specialty_name, episodes,
length_of_episode, average_length_of_episode,
spells, length_of_spell, average_length_of_spell)
library(janitor)
library(tidyverse)
library(lubridate)
library(ggplot2)
#raw_staff_beds <- read_csv("data/beds_by_nhs_board_of_treatment_and_specialty.csv")
raw_activity <- read_csv("data/inpatient_and_daycase_by_nhs_board_of_treatment_and_specialty.csv")
activity_no_gj <- raw_activity %>%
clean_names() %>%
# Create new column for quarters
mutate(q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
# rename the columns above
mutate(date = quarter,
quarter = q) %>%
# Change Heath Board names to read better
mutate(
hb =
if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", NA_character_)
))))))))))))))) %>%
# take out location names to take out duplicate
filter(location_qf == "d") %>%
# take out Golden Jubilee
filter(hb != is.na(hb)) %>%
# take out unsed columns
select(date, quarter, hb, location, admission_type,
specialty, specialty_name, episodes,
length_of_episode, average_length_of_episode,
spells, length_of_spell, average_length_of_spell)
activity_no_gj
bigest_type <- activity_no_gj %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients") %>%
group_by(specialty_name) %>%
summarise(count = sum(episodes)) %>%
arrange(desc(count)) %>%
head(3)
bigest_type
activity_no_gj %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients",
specialty_name != c(bigest_type$specialty_name)) %>%
group_by(specialty_name) %>%
summarise(count = sum(episodes)) %>%
arrange(desc(count))
bigest_occupancy <- wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
specialty_name != "Obstetrics Grouping",
specialty_name != "Dental Grouping",
hb == "Scotland") %>%
group_by(specialty_name) %>%
summarise(count = sum(percentage_occupancy)) %>%
arrange(desc(count)) %>%
head(3)
wranged_beds_no_gj %>%
filter(specialty_name %in% c(bigest_occupancy$specialty_name)) %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb == "Scotland") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
ggplot(aes(x = date, y = percentage_occupancy, col = specialty_name)) +
geom_point() +
geom_line()
activity_no_gj %>%
filter(hb %in% "Scotland",
specialty_name %in% "Infectious Diseases",
admission_type %in% c("Elective Inpatients",
"Emergency Inpatients",
"Transfers")) %>%
ggplot(aes(x = date, y = spells, col = admission_type)) +
geom_point() +
geom_line()
wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
specialty_name == "Emergency  Grouping") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
ggplot(aes(x = date, y = percentage_occupancy, col = hb)) +
geom_point() +
geom_line()
wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
specialty_name == "Emergency Grouping") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
ggplot(aes(x = date, y = percentage_occupancy, col = hb)) +
geom_point() +
geom_line()
wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
specialty_name == "Emergency Grouping") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
ggplot(aes(x = date, y = percentage_occupancy, col = hb)) +
geom_point() +
geom_line() +
facet_wrap(~ hb)
wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
specialty_name == "Emergency Grouping") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
ggplot(aes(x = date, y = percentage_occupancy, col = hb)) +
geom_point() +
geom_line() +
facet_wrap(~ hb) +
theme(legend.position="none")
bigest_specialty <- wranged_beds_no_gj %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb == "Scotland") %>%
group_by(specialty_name) %>%
summarise(count = sum(all_staffed_beds)) %>%
arrange(desc(count)) %>%
head(3)
wranged_beds_no_gj %>%
filter(specialty_name %in% c(bigest_specialty$specialty_name)) %>%
filter(str_detect(specialty_name, " Grouping"),
specialty_name != "Other Grouping",
hb == "Scotland") %>%
mutate(specialty_name = str_sub(specialty_name, start = 1, end = -9)) %>%
ggplot(aes(x = date, y = all_staffed_beds, col = specialty_name)) +
geom_point() +
geom_line()
wranged_beds_no_gj %>%
filter(specialty_name %in% c("All Acute", "All Specialties"),
hb %in% "Scotland") %>%
ggplot(aes(x = date, y = percentage_occupancy, col = specialty_name)) +
geom_point() +
geom_line()
wranged_beds_no_gj %>%
filter(specialty_name %in% c("All Acute", "All Specialties"),
hb %in% "Scotland") %>%
ggplot(aes(x = date, y = all_staffed_beds, col = specialty_name)) +
geom_point() +
geom_line()
wranged_beds_no_gj %>%
filter(specialty_name %in% c("All Acute", "All Specialties"),
hb != "Scotland",
hb != "Golden Jubilee") %>%
ggplot(aes(x = date, y = all_staffed_beds, col = specialty_name)) +
geom_point() +
geom_line() +
facet_wrap(~ hb) +
theme(legend.position="none")
wranged_beds_no_gj %>%
filter(specialty_name %in% c("All Acute", "All Specialties"),
hb != "Scotland") %>%
ggplot(aes(x = date, y = all_staffed_beds, col = specialty_name)) +
geom_point() +
geom_line() +
facet_wrap(~ hb) +
theme(legend.position="none")
