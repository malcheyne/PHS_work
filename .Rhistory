if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", hb)
)))))))))))))))) %>%
# Change location names to take out dupitice
mutate(location = if_else(location %in% "SB0801", "Golden Jubilee",
if_else(location %in% "S08000015", "Ayrshire & Arran",
if_else(location %in% "S08000016", "Borders",
if_else(location %in% "S08000017", "Dumfries & Galloway",
if_else(location %in% "S08000019", "Forth Valley",
if_else(location %in% "S08000020", "Grampian",
if_else(location %in% "S08000022", "Highland",
if_else(location %in% "S08000024", "Lothian",
if_else(location %in% "S08000025", "Orkney",
if_else(location %in% "S08000026", "Shetland",
if_else(location %in% "S08000028", "Western Isles",
if_else(location %in% "S08000029", "Fife",
if_else(location %in% "S08000030", "Tayside",
if_else(location %in% "S08000031", "Greater Glasgow & Clyde",
if_else(location %in% "S08000032", "Lanarkshire",
if_else(location %in% "S92000003", "Scotland", NA_character_
#  if_else(location %in% "^[A-Z0-9]{5}", , location)
))))))))))))))))) %>%
filter(location != is.na(location))
activity <- raw_activity %>%
clean_names() %>%
mutate(q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
# Change Heath Board names to read better
# probly don'tneed
mutate(hb = if_else(hb %in% "SB0801", "Golden Jubilee",
if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", hb)
)))))))))))))))) %>%
# Change location names to take out dupitice
mutate(location = if_else(location %in% "SB0801", "Golden Jubilee",
if_else(location %in% "S08000015", "Ayrshire & Arran",
if_else(location %in% "S08000016", "Borders",
if_else(location %in% "S08000017", "Dumfries & Galloway",
if_else(location %in% "S08000019", "Forth Valley",
if_else(location %in% "S08000020", "Grampian",
if_else(location %in% "S08000022", "Highland",
if_else(location %in% "S08000024", "Lothian",
if_else(location %in% "S08000025", "Orkney",
if_else(location %in% "S08000026", "Shetland",
if_else(location %in% "S08000028", "Western Isles",
if_else(location %in% "S08000029", "Fife",
if_else(location %in% "S08000030", "Tayside",
if_else(location %in% "S08000031", "Greater Glasgow & Clyde",
if_else(location %in% "S08000032", "Lanarkshire",
if_else(location %in% "S92000003", "Scotland", NA_character_
#  if_else(location %in% "^[A-Z0-9]{5}", , location)
))))))))))))))))) %>%
filter(location != is.na(location)) %>%
select(!(quarter_qf, hbqf, location_qf,
raw_activity %>%
clean_names() %>%
mutate(q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
# Change Heath Board names to read better
# probly don'tneed
mutate(hb = if_else(hb %in% "SB0801", "Golden Jubilee",
if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", hb)
)))))))))))))))) %>%
# Change location names to take out dupitice
mutate(location = if_else(location %in% "SB0801", "Golden Jubilee",
if_else(location %in% "S08000015", "Ayrshire & Arran",
if_else(location %in% "S08000016", "Borders",
if_else(location %in% "S08000017", "Dumfries & Galloway",
if_else(location %in% "S08000019", "Forth Valley",
if_else(location %in% "S08000020", "Grampian",
if_else(location %in% "S08000022", "Highland",
if_else(location %in% "S08000024", "Lothian",
if_else(location %in% "S08000025", "Orkney",
if_else(location %in% "S08000026", "Shetland",
if_else(location %in% "S08000028", "Western Isles",
if_else(location %in% "S08000029", "Fife",
if_else(location %in% "S08000030", "Tayside",
if_else(location %in% "S08000031", "Greater Glasgow & Clyde",
if_else(location %in% "S08000032", "Lanarkshire",
if_else(location %in% "S92000003", "Scotland", NA_character_
#  if_else(location %in% "^[A-Z0-9]{5}", , location)
))))))))))))))))) %>%
filter(location != is.na(location))
activity <- raw_activity %>%
clean_names() %>%
mutate(q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
# Change Heath Board names to read better
# probly don'tneed
mutate(hb = if_else(hb %in% "SB0801", "Golden Jubilee",
if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", hb)
)))))))))))))))) %>%
# Change location names to take out dupitice
mutate(location = if_else(location %in% "SB0801", "Golden Jubilee",
if_else(location %in% "S08000015", "Ayrshire & Arran",
if_else(location %in% "S08000016", "Borders",
if_else(location %in% "S08000017", "Dumfries & Galloway",
if_else(location %in% "S08000019", "Forth Valley",
if_else(location %in% "S08000020", "Grampian",
if_else(location %in% "S08000022", "Highland",
if_else(location %in% "S08000024", "Lothian",
if_else(location %in% "S08000025", "Orkney",
if_else(location %in% "S08000026", "Shetland",
if_else(location %in% "S08000028", "Western Isles",
if_else(location %in% "S08000029", "Fife",
if_else(location %in% "S08000030", "Tayside",
if_else(location %in% "S08000031", "Greater Glasgow & Clyde",
if_else(location %in% "S08000032", "Lanarkshire",
if_else(location %in% "S92000003", "Scotland", NA_character_
#  if_else(location %in% "^[A-Z0-9]{5}", , location)
))))))))))))))))) %>%
filter(location != is.na(location)) %>%
select(quarter, q, hb, location, admission_type, specialty, specialty_name, episodes, length_of_episode, average_length_of_episode, spells, length_of_spell, average_length_of_spell)
activity
activity %>%
count(admission_type)
activity %>%
filter(hb %in% "Scotland") %>%
ggplot(aes(x = quarter, y = percentage_occupancy, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(admission_type %in% "Emergency Inpatients") %>%
count(specialty_name)
activity %>%
filter(admission_type %in% "Elective Inpatients") %>%
count(specialty_name)
559/256
activity %>%
filter(hb %in% "Scotland") %>%
ggplot(aes(x = quarter, y = admission_type, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland") %>%
ggplot(aes(x = quarter, y = episodes, col = admission_type)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland") %>%
group_by(admission_type) %>%
ggplot(aes(x = quarter, y = episodes, col = admission_type)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland") %>%
group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = admission_type)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients") %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = admission_type)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients")
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients") %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Elective Inpatients") %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients",
specialty_name %in% "General Medicine") %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
#admission_type %in% "Emergency Inpatients",
specialty_name %in% "General Medicine") %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
#admission_type %in% "Emergency Inpatients",
specialty_name %in% "General Medicine") %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = admission_type)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients",
episodes > 500) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients",
episodes > 700) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients",
episodes > 900) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients",
episodes > 1000) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients",
episodes > 5000) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients",
episodes > 4000) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients",
episodes > 3000) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Elective Inpatients",
episodes > 3000) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Elective Inpatients") %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Elective Inpatients",
episodes > 3000) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Elective Inpatients") %>%
head(5) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Elective Inpatients") %>%
head(specialty_name) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Emergency Inpatients",
episodes > 3000) %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity %>%
filter(hb %in% "Scotland",
admission_type %in% "Elective Inpatients") %>%
# group_by(episodes) %>%
ggplot(aes(x = quarter, y = episodes, col = specialty_name)) +
geom_point() +
geom_line()
activity <- raw_activity %>%
clean_names() %>%
mutate(q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
mutate(date = quarter,
quarter = q)
# Change Heath Board names to read better
# probly don'tneed
mutate(hb = if_else(hb %in% "SB0801", "Golden Jubilee",
if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", hb)
)))))))))))))))) %>%
# Change location names to take out dupitice
mutate(location = if_else(location %in% "SB0801", "Golden Jubilee",
if_else(location %in% "S08000015", "Ayrshire & Arran",
if_else(location %in% "S08000016", "Borders",
if_else(location %in% "S08000017", "Dumfries & Galloway",
if_else(location %in% "S08000019", "Forth Valley",
if_else(location %in% "S08000020", "Grampian",
if_else(location %in% "S08000022", "Highland",
if_else(location %in% "S08000024", "Lothian",
if_else(location %in% "S08000025", "Orkney",
if_else(location %in% "S08000026", "Shetland",
if_else(location %in% "S08000028", "Western Isles",
if_else(location %in% "S08000029", "Fife",
if_else(location %in% "S08000030", "Tayside",
if_else(location %in% "S08000031", "Greater Glasgow & Clyde",
if_else(location %in% "S08000032", "Lanarkshire",
if_else(location %in% "S92000003", "Scotland", NA_character_
#  if_else(location %in% "^[A-Z0-9]{5}", , location)
))))))))))))))))) %>%
# filter out the na
filter(location != is.na(location)) %>%
# take out unsed columns
select(date, quarter, hb, location, admission_type, specialty, specialty_name, episodes, length_of_episode, average_length_of_episode, spells, length_of_spell, average_length_of_spell)
activity <- raw_activity %>%
clean_names() %>%
mutate(q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
mutate(date = quarter,
quarter = q)
# Change Heath Board names to read better
# probly don'tneed
mutate(hb = if_else(hb %in% "SB0801", "Golden Jubilee",
if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", hb)
)))))))))))))))) %>%
# Change location names to take out dupitice
mutate(location = if_else(location %in% "SB0801", "Golden Jubilee",
if_else(location %in% "S08000015", "Ayrshire & Arran",
if_else(location %in% "S08000016", "Borders",
if_else(location %in% "S08000017", "Dumfries & Galloway",
if_else(location %in% "S08000019", "Forth Valley",
if_else(location %in% "S08000020", "Grampian",
if_else(location %in% "S08000022", "Highland",
if_else(location %in% "S08000024", "Lothian",
if_else(location %in% "S08000025", "Orkney",
if_else(location %in% "S08000026", "Shetland",
if_else(location %in% "S08000028", "Western Isles",
if_else(location %in% "S08000029", "Fife",
if_else(location %in% "S08000030", "Tayside",
if_else(location %in% "S08000031", "Greater Glasgow & Clyde",
if_else(location %in% "S08000032", "Lanarkshire",
if_else(location %in% "S92000003", "Scotland", NA_character_
#  if_else(location %in% "^[A-Z0-9]{5}", , location)
))))))))))))))))) %>%
# filter out the na
filter(location != is.na(location)) %>%
# take out unsed columns
select(date, quarter, hb, location, admission_type, specialty, specialty_name, episodes, length_of_episode, average_length_of_episode, spells, length_of_spell, average_length_of_spell)
activity <- raw_activity %>%
clean_names() %>%
mutate(q = str_sub(quarter, -2)) %>%
# Change to date format
mutate(quarter = yq(quarter)) %>%
mutate(date = quarter,
quarter = q) %>%
# Change Heath Board names to read better
# probly don'tneed
mutate(hb = if_else(hb %in% "SB0801", "Golden Jubilee",
if_else(hb %in% "S08000015", "Ayrshire & Arran",
if_else(hb %in% "S08000016", "Borders",
if_else(hb %in% "S08000017", "Dumfries & Galloway",
if_else(hb %in% "S08000019", "Forth Valley",
if_else(hb %in% "S08000020", "Grampian",
if_else(hb %in% "S08000022", "Highland",
if_else(hb %in% "S08000024", "Lothian",
if_else(hb %in% "S08000025", "Orkney",
if_else(hb %in% "S08000026", "Shetland",
if_else(hb %in% "S08000028", "Western Isles",
if_else(hb %in% "S08000029", "Fife",
if_else(hb %in% "S08000030", "Tayside",
if_else(hb %in% "S08000031", "Greater Glasgow & Clyde",
if_else(hb %in% "S08000032", "Lanarkshire",
if_else(hb %in% "S92000003", "Scotland", hb)
)))))))))))))))) %>%
# Change location names to take out dupitice
mutate(location = if_else(location %in% "SB0801", "Golden Jubilee",
if_else(location %in% "S08000015", "Ayrshire & Arran",
if_else(location %in% "S08000016", "Borders",
if_else(location %in% "S08000017", "Dumfries & Galloway",
if_else(location %in% "S08000019", "Forth Valley",
if_else(location %in% "S08000020", "Grampian",
if_else(location %in% "S08000022", "Highland",
if_else(location %in% "S08000024", "Lothian",
if_else(location %in% "S08000025", "Orkney",
if_else(location %in% "S08000026", "Shetland",
if_else(location %in% "S08000028", "Western Isles",
if_else(location %in% "S08000029", "Fife",
if_else(location %in% "S08000030", "Tayside",
if_else(location %in% "S08000031", "Greater Glasgow & Clyde",
if_else(location %in% "S08000032", "Lanarkshire",
if_else(location %in% "S92000003", "Scotland", NA_character_
#  if_else(location %in% "^[A-Z0-9]{5}", , location)
))))))))))))))))) %>%
# filter out the na
filter(location != is.na(location)) %>%
# take out unsed columns
select(date, quarter, hb, location, admission_type, specialty, specialty_name, episodes, length_of_episode, average_length_of_episode, spells, length_of_spell, average_length_of_spell)
activity
source("~/.active-rstudio-document", echo=TRUE)
library(janitor)
library(tidyverse)
library(lubridate)
library(here)
library(here)
source("~/Code/GitHub/group_work/de11_project/scripts/cleaning_inpatient_and_daycase_by_nhs_board_of_treatment_and_specialty.R", echo=TRUE)
source("~/Code/GitHub/group_work/de11_project/scripts/cleaning_inpatient_and_daycase_by_nhs_board_of_treatment_and_specialty.R", echo=TRUE)
library(janitor)
library(tidyverse)
library(lubridate)
library(here)
